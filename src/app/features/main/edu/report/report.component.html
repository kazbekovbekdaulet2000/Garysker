<ng-container *ngIf="report$ | async as report">

  <div @opacityAnimation class="report">

    <div class="report-menu">
      <div class="icon">
        {{report.icon}}
      </div>
      <p>{{report.category}}</p>
      <p>{{report.created_at | DateRemained}}</p>
      <p [style.opacity]="0.7">By {{report.author.full_name}}</p>
      <p [style.opacity]="0.7"> | </p>
      <p [style.opacity]="0.7">{{report.read_time | ReadTime}}</p>
    </div>

    <h1 class="report-header"> {{report.title}}</h1>

    <div #body class="report-body" [innerHTML]="report.body | sanitizer"></div>

    <div class="report-stat">

      <div>
        <img src="assets/icons/comment.svg" alt="">
        {{report.comments_count}}
      </div>

      <img class="cursor-pointer" (click)="saveReport(report.id)"
        [src]="report.bookmarked ? 'assets/icons/saved.svg' : 'assets/icons/unsaved.svg'" alt="">
      
      <!-- <a [href]="getLink" target="_blank" rel="noopener" type="button"> -->
      <img class="cursor-pointer" (click)="openShareModal()" src="assets/icons/share.svg" alt="">

      <div class="report-stat-views cursor-pointer" (click)="likeReport(report.id)">
        <img [src]="report.liked ? 'assets/icons/liked.svg' : 'assets/icons/like.svg'" alt="">
        {{report.likes_count}}
      </div>

    </div>

    <div class="report-author">
      <img class="report-author-photo"
        [src]="report.author.image.includes('/media/garysh.jpg') ? 'assets/images/user.png' : report.author.image">
      {{report.author.full_name}}
    </div>

  </div>

  <ng-container *ngIf="comments$ | async as comments">

    <div class="comment-holder" [formGroup]="formGroup">

      <h5>{{report.comments_count}} комментариев</h5>

      <div @heightAnimation class="reply" *ngIf="replyContent">
        <img class="reply-sign" src="assets/icons/reply-sign.svg" draggable=false>
        <img class="reply-image"
          [src]="replyContent.owner.image.includes('/media/garysh.jpg') ? 'assets/images/user.png' : replyContent.owner.image">
        <div class="reply-info">
          <p class="reply-info-name">{{replyContent.owner.full_name}}</p>
          <p class="reply-info-date">{{replyContent.created_at | DateRemained}}</p>
        </div>
        <div class="reply-cancel cursor-pointer" (click)="removeReplyParent()">отменить</div>
      </div>

      <!-- <input *ngIf="(access$ | async) !== ''" type="text" (keyup.enter)="sendComment()" formControlName="body"
        placeholder="Написать комментарий..." class="textfield" [style.margin-top]="replyContent ?? 0"> -->
        <div class="textfield">
          <textarea
            *ngIf="(access$ | async) !== ''" 
            rows=3 
            placeholder="Написать комментарий..." 
            class="textfield-area" 
            formControlName="body"
          ></textarea>
          <button class="btn textfield-btn" (click)="sendComment()">Отправить</button>
        </div>
      <app-comment-module *ngFor="let comment of comments.results" (reply)="addReply($event)" [comment]="comment">
      </app-comment-module>

    </div>

  </ng-container>

</ng-container>