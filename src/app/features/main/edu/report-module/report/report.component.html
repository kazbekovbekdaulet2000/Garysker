<ng-container *ngIf="report$ | async as report">

  <div @opacityAnimation class="report">

    <app-report-menu [report]="report"></app-report-menu>

    <h1 class="report-header"> {{report.title}}</h1>

    <div #body class="report-body" [innerHTML]="report.body | sanitizer"></div>

    <div class="report-stat">

      <div>
        <img src="assets/icons/comment.svg" alt="">
        {{report.comments_count}}
      </div>

      <img class="cursor-pointer" (click)="onSave(report.id)"
        [src]="report.bookmarked ? 'assets/icons/saved.svg' : 'assets/icons/unsaved.svg'" alt="">
      
      <img class="cursor-pointer" (click)="onShare()" src="assets/icons/share.svg" alt="">

      <div class="report-stat-views cursor-pointer" (click)="likeReport(report.id)">
        <img [src]="report.liked ? 'assets/icons/liked.svg' : 'assets/icons/like.svg'" alt="">
        {{report.likes_count}}
      </div>

    </div>

    <div class="report-author">
      <img class="report-author-photo"
        [src]="report.author.image.includes('/media/garysh.jpg') ? 'assets/images/user.png' : report.author.image">
      {{report.author.full_name}}
    </div>

  </div>

  <ng-container *ngIf="comments$ | async as comments">

    <div class="comment-holder" [formGroup]="formGroup">

      <h5>{{report.comments_count}} комментариев</h5>

      <div @heightAnimation class="reply" *ngIf="replyContent">
        
        <img class="reply-sign" src="assets/icons/reply-sign.svg" draggable=false>
        <img class="reply-image"
          [src]="replyContent.owner.image.includes('/media/garysh.jpg') ? 'assets/images/user.png' : replyContent.owner.image">
        <div class="reply-info">
          <p class="reply-info-name">{{replyContent.owner.full_name}}</p>
          <p class="reply-info-date">{{replyContent.created_at | DateRemained}}</p>
        </div>
        <div class="reply-cancel cursor-pointer" (click)="removeReplyParent()">отменить</div>
      
      </div>

      <div *ngIf="(access$ | async) !== ''" class="textfield">

        <textarea
          rows=3 
          placeholder="Написать комментарий..." 
          class="textfield-area" 
          [class.large]="textInputLarge"
          formControlName="body"
          (click)="textareaTap()"
        ></textarea>
    
        <button @opacityAnimation *ngIf="textInputLarge" class="btn textfield-btn" (click)="sendComment()">Отправить</button>
    
      </div>
      
      <app-comment-module 
        *ngFor="let comment of comments.results" 
        (reply)="addReply($event)" 
        [comment]="comment">
      </app-comment-module>

      <a class="d-flex loadmore my-2 align-items-center justify-content-center cursor-pointer" *ngIf="comments.next" (click)="loadMore()">
        загрузить больше
      </a>

    </div>

  </ng-container>

</ng-container>